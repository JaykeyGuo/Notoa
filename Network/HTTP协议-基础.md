# HTTP协议-基础

### HTTP 头部

#### 请求体

![](https://static001.geekbang.org/resource/image/1f/ea/1fe4c1121c50abcf571cebd677a8bdea.png)

#### 响应体

![](https://static001.geekbang.org/resource/image/cb/75/cb0d1d2c56400fe9c9988ee32842b175.png)

*头字段不区分大小写，原则上不能重复。*

##### 常用头字段

HTTP协议规定了非常多的头部字段，可以分为以下四大类：

1. 通用字段：在请求头和响应头都可以出现；
2. 请求字段：仅能出现在请求头里，进一步说明请求信息或者额外的附加条件；
3. 响应字段：仅能出现在响应头里，补充说明响应报文的信息；
4. 实体字段：它实际上属于通用字段，但专门描述body的而外信息。

**Host字段是唯一一个HTTP/1.1 规范里要求必须出现的字段，如果请求头里没有Host，那这就是一个错误的报文。**



---

### HTTP 请求方法

HTTP1.1规定里8种请求方法，都必须大写的形式存在：

1. GET：获取资源，可以理解为读取或者下载数据；

2. HEAD：获取资源的元信息；

   HEAD和GET类似，也是从服务器获取资源，但是不会返回请求的实体数据，只有响应头（元信息），是GET的简易版，如果不需要资源的话，可以避免传输body数据的浪费。

3. POST：向资源提交数据，相当于写入或上传数据；

4. PUT：类似POST；

   POST 表示的是“新建”“create”的含义，而 PUT 则是“修改”“update”的含义。

5. DELETE：删除资源；

   DELETE方法指示服务器删除资源，因为这个动作太危险，所以通常服务器不会执行真正的删除操作，而是对资源做一个删除标记。大多数服务器不处理该请求。

6. CONNECT：建立特殊的连接隧道；

   CONNECT是一个比较特殊的方法，要求服务器为客户端和另一台远程服务器建立一条特殊的连接隧道，这时Web服务器在中间充当了代理的角色。

7. OPTIONS：列出课对资源实行的方法；

   OPTIONS方法要求服务器列出可对资源实行的操作方法，在响应头的Allow字段里返回。

8. TRACE：追踪请求-响应的传输路径。

   TRACE方法多用于对HTTP链路的测试或者诊断，可以显示出请求-响应的传输路径。本意是好的，但是存在漏洞，会泄露网站信息，所以也被禁用。

##### 安全和幂等

安全：GET、HEAD（只读）

不安全：POST、PUT、DELETE（修改服务器资源和增删数据）

幂等：GET、HEAD、PUT

非幂等：POST

> POST是“新增或者提交数据”，多次提交数据会重建多个资源，所以不是幂等的；而PUT是“替换或更新数据”，多次更新一个资源，资源还是会第一次更新的状态，所以是幂等的。

---



### URI

![](https://static001.geekbang.org/resource/image/46/2a/46581d7e1058558d8e12c1bf37d30d2a.png)

> 1. URI 是用来唯一标记服务器上资源的一个字符串，通常也称为 URL；
> 2. URI 通常由 scheme、host:port、path 和 query 四个部分组成，有的可以省略；
> 3. scheme 叫“方案名”或者“协议名”，表示资源应该使用哪种协议来访问；
> 4. “host:port”表示资源所在的主机名和端口号；
> 5. path 标记资源所在的位置；
> 6. query 表示对资源附加的额外要求；
> 7. 在 URI 里对“@&/”等特殊字符和汉字必须要做编码，否则服务器收到 HTTP 报文后会无法正确处理。非 ASCII 码或特殊字符转换成十六进制字节值，然后前面再加上一个“%”

---



### Status Code 状态码

1. 1xx：提示信息，表示目前是协议处理的中间状态，还需要后续的操作；

2. 2xx：成功，报文已经收到并被正确处理；

   **200 OK** 成功

   **204 No Content** 响应头后没有body数据

   **206 Partial Content**  body 里的数据不是资源的全部，而是其中的一部分。在头字段种还会有 **Content-Range**表示响应报文里body数据的具体范围，供客户端确认。

3. 3xx：重定向，资源位置发生变动，需要客户端重新发送请求；

   **301 Moved Permanently** 永久重定向

   **302 Found / Moved Temporarily** 临时重定向

   **304 Not Modified** 用于 If-Modified-Since 等条件请求，表示资源未修改，用于缓存控制。它不具有通常的跳转含义，但可以理解成“重定向已到缓存的文件”（即“缓存重定向”）。

4. 4xx：客户端错误，请求报文有误，服务器无法处理；

   **400 Bad Request** 服务器出错。

   **403 Forbidden** 实际上不是客户端的请求出错，而是表示服务器禁止访问资源。

   **404 Not Found** 就是挂了。

   **405 Method Not Allowed**：不允许使用某些方法操作资源，例如不允许 POST 只能 GET；
   **406 Not Acceptable**：资源无法满足客户端请求的条件，例如请求中文但只有英文；
   **408 Request Timeout**：请求超时，服务器等待了过长的时间；
   **409 Conflict**：多个请求发生了冲突，可以理解为多线程并发时的竞态；
   **413 Request Entity Too Large**：请求报文里的 body 太大；
   **414 Request-URI Too Long**：请求行里的 URI 太大；
   **429 Too Many Requests**：客户端发送了太多的请求，通常是由于服务器的限连策略；
   **431 Request Header Fields Too Large**：请求头某个字段或总体太大；

5. 5xx：服务器错误，服务器在处理请求时内部发生了错误。

   **500 Internal Server Error**：服务器错误；

   **501 Not Implemented**：表示客户端请求的功能还不支持；

   **502 Bad Gateway**：通常是服务器作为网关或者代理时返回的错误码，表示服务器自身工作正常，访问后端服务器时发生了错误，但具体的错误原因也是不知道的。

   **503 Service Unavailable**：表示服务器当前很忙，暂时无法响应服务，我们上网时有时候遇到的“网络服务正忙，请稍后重试”的提示信息就是状态码 503。

---

### HTTP 特点

![](https://static001.geekbang.org/resource/image/78/4a/7808b195c921e0685958c20509855d4a.png)

1. HTTP 是**灵活可扩展**的，可以任意添加头字段实现任意功能；
2. HTTP 是**可靠传输协议**，基于 TCP/IP 协议“尽量”保证数据的送达；
3. HTTP 是**应用层协议**，比 FTP、SSH 等更通用功能更多，能够传输任意数据；
4. HTTP 使用了**请求 - 应答模式**，客户端主动发起请求，服务器被动回复请求；
5. HTTP 本质上是**无状态**的，每个请求都是互相独立、毫无关联的，协议不要求客户端或服务器记录请求相关的信息。

> 以前HTTP协议还有一个“无连接”的特点，指的是协议不保持连接状态，每次请求英东后都会关闭连接，这就和UDP几乎一模一样了。但这样会很影响性能，在HTTP/1.1里就改成了总是默认启用keepalive长连接机制，所以现在的HTTP已经不再是“无连接”的。

#### HTTP/1.1 优缺点

1. HTTP 最大的优点是**简单、灵活和易于扩展**；
2. HTTP 拥有**成熟的软硬件环境**，应用的非常广泛，是互联网的基础设施；
3. HTTP 是**无状态的**，可以轻松实现集群化，扩展性能，但有时也需要用 **Cookie 技术来实现“有状态”**；
4. HTTP 是**明文传输**，数据完全肉眼可见，能够方便地研究分析，但也**容易被窃听**；
5. HTTP 是**不安全的**，无法验证通信双方的身份，也不能判断报文是否被窜改；
6. HTTP 的**性能不算差**，但不完全适应现在的互联网，还有很大的提升空间。